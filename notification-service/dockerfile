# =========
# BUILD STAGE
# =========
FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
WORKDIR /src

# Copy everything into the build container
COPY . .

# Set the working directory to the API project (adjust if path differs)
WORKDIR /src/src/NotificationService.Api

# Restore and publish
RUN dotnet restore
RUN dotnet publish -c Release -o /app/publish /p:UseAppHost=false

# =========
# RUNTIME STAGE
# =========
FROM mcr.microsoft.com/dotnet/aspnet:9.0 AS final
WORKDIR /app

# Copy published output from build stage
COPY --from=build /app/publish ./

# Expose the default ASP.NET Core port (change if your app uses another)
EXPOSE 8080

# Configure ASP.NET Core URLS (Kestrel) to listen on port 8080
ENV ASPNETCORE_URLS=http://+:8080
ENV ASPNETCORE_ENVIRONMENT=Production

# ENTRYPOINT
ENTRYPOINT ["dotnet", "NotificationService.Api.dll"]